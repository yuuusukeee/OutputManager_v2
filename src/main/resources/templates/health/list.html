<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="ja">
<head>
  <meta charset="UTF-8"/>
  <title>健康</title>
  <link rel="stylesheet" th:href="@{/css/app.css}"/>
  <style>
    .container{max-width:1120px;margin:24px auto}
    .grid{display:grid;grid-template-columns:repeat(3,1fr);gap:12px}
    @media(max-width:1024px){.grid{grid-template-columns:repeat(2,1fr)}}
    @media(max-width:640px){.grid{grid-template-columns:1fr}}
    .card{border:1px solid #e5e7eb;border-radius:12px;overflow:hidden;background:#fff}
    .thumb-wrap{position:relative;width:100%;aspect-ratio:16/9;background:#f3f4f6}
    .thumb{width:100%;height:100%;object-fit:cover;display:block}
    .play{position:absolute;inset:0;display:flex;align-items:center;justify-content:center}
    .play::before{content:"";width:48px;height:48px;border-radius:999px;background:rgba(0,0,0,.45)}
    .play::after{content:"";margin-left:-32px;border-left:18px solid #fff;border-top:11px solid transparent;border-bottom:11px solid transparent}
    .meta{padding:10px 12px}
    .title{white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
    .pager{display:flex;justify-content:center;gap:12px;margin:20px 0}
    a.card{display:block;text-decoration:none;color:inherit}
    .empty{color:#6b7280}
  </style>
</head>
<body>
  <div th:replace="~{fragments/header :: body}"></div>
  <main class="container">
    <h2 class="section-title">健康</h2>

    <p class="empty" th:if="${items == null or #lists.isEmpty(items)}">データがありません。</p>

    <div class="grid" th:if="${items != null and !#lists.isEmpty(items)}">
      <a class="card" th:each="o : ${items}" th:href="@{/outputs/{id}(id=${o.id})}">
        <div class="thumb-wrap">
          <img class="thumb" loading="lazy"
               th:alt="${o.title}"
               th:attr="data-icon=${o.icon},data-vurl=${o.videoUrl}"
               th:src="@{/img/placeholder.png}">
          <div class="play" th:if="${o.videoUrl != null and !#strings.isEmpty(o.videoUrl)}"></div>
        </div>
        <div class="meta"><div class="title" th:text="${#strings.abbreviate(o.title,15)}">タイトル</div></div>
      </a>
    </div>

    <div class="pager" th:if="${hasPrev or hasNext}">
      <a class="btn btn-outline" th:if="${hasPrev}" th:href="@{/health(page=${prevPage}, size=18)}">前へ</a>
      <a class="btn btn-outline" th:if="${hasNext}" th:href="@{/health(page=${nextPage}, size=18)}">次へ</a>
    </div>
  </main>

  <script>
    function ytId(url){
      if(!url) return null;
      try{
        const u=new URL(url);const h=u.hostname.replace('www.','');
        if(h==='youtu.be'){return u.pathname.slice(1);}
        if(h==='youtube.com'||h==='m.youtube.com'){
          if(u.pathname.startsWith('/watch')) return u.searchParams.get('v');
          if(u.pathname.startsWith('/shorts/')) return u.pathname.split('/')[2];
          if(u.pathname.startsWith('/embed/')) return u.pathname.split('/')[2];
        }
      }catch(_){}
      return null;
    }
    document.querySelectorAll('img.thumb').forEach(img=>{
      const icon=img.getAttribute('data-icon');const vurl=img.getAttribute('data-vurl');
      if(icon && icon.trim()!==''){ img.src=icon; return; }
      const id=ytId(vurl); if(id){ img.src=`https://img.youtube.com/vi/${id}/hqdefault.jpg`; }
    });
  </script>
</body>
</html>
