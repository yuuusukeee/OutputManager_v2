<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="ja">
<head>
  <meta charset="UTF-8"/>
  <title th:text="${output != null ? output.title : '詳細'}">Output Detail</title>
  <link rel="stylesheet" th:href="@{/css/app.css}"/>
</head>
<body>
  <!-- ※ 1)は完了済みの想定ですが、ここはリクエスト通り現状そのまま -->
  <div th:replace="~{fragments/header :: body/*}"></div>

  <main class="container" style="max-width:900px; margin:24px auto;">

    <a th:href="@{/outputs}">← 一覧に戻る</a>

    <h1 th:text="${output != null ? output.title : '（タイトル未設定）'}">タイトル</h1>

    <!-- サムネイル（画像フォールバック） -->
    <div class="detail-thumb" style="margin:16px 0;">
      <!-- icon があるなら本物 -->
      <img th:if="${output != null and !#strings.isEmpty(output.icon)}"
           th:src="${output.icon}" alt="thumbnail"
           style="max-width:100%; height:auto;">

      <!-- icon が無いならダミー -->
      <img th:if="${output == null or #strings.isEmpty(output.icon)}"
           th:src="@{/img/placeholder.png}" alt="no image"
           style="max-width:100%; height:auto;">
    </div>

    <p>
      作成:
      <span th:text="${output != null && output.createdAt != null
                      ? #temporals.format(output.createdAt,'yyyy-MM-dd HH:mm')
                      : ''}">2025-08-17 12:00</span>
      <span th:if="${output != null && output.updatedAt != null}">
        / 更新:
        <span th:text="${#temporals.format(output.updatedAt,'yyyy-MM-dd HH:mm')}">2025-08-17 12:00</span>
      </span>
    </p>

    <!-- カテゴリ名（categoryNameMap が null でも落ちないようにガード） -->
    <p>
      カテゴリ:
      <span th:text="${
          output != null
          ? (
              categoryNameMap != null && categoryNameMap.containsKey(output.categoryId)
                ? categoryNameMap[output.categoryId]
                : (output.categoryName != null ? output.categoryName : output.categoryId)
            )
          : ''
        }">カテゴリ</span>
      <span th:if="${output != null && output.favorite}"> / ★お気に入り</span>
    </p>

    <!-- 本文（HTML許可なら utext、プレーンなら text を使う） -->
    <article th:utext="${output != null ? (output.detail != null ? output.detail : output.content) : ''}">
      本文
    </article>

    <!-- 任意: 動画URL -->
    <div th:if="${output != null && output.videoUrl != null && !#strings.isEmpty(output.videoUrl)}" style="margin-top:16px;">
      <a th:href="${output.videoUrl}" target="_blank" rel="noopener">関連動画を開く</a>
    </div>

  </main>
</body>
</html>