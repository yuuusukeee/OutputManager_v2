<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.example.outputmanager.mapper.FavoriteMapper">

  <!-- 追加 -->
  <insert id="insert" parameterType="com.example.outputmanager.domain.Favorite">
    INSERT INTO favorites (user_id, output_id)
    VALUES (#{userId}, #{outputId})
  </insert>

  <!-- 解除 -->
  <delete id="delete">
    DELETE FROM favorites
    WHERE user_id = #{userId}
      AND output_id = #{outputId}
  </delete>

  <!-- 自分のお気に入り全件（レコード） -->
  <select id="selectByUserId" parameterType="int" resultType="com.example.outputmanager.domain.Favorite">
    SELECT
      id,
      user_id   AS userId,
      output_id AS outputId,
      created_at AS createdAt
    FROM favorites
    WHERE user_id = #{userId}
    ORDER BY created_at DESC, id DESC
  </select>

  <!-- 存在確認（0/1） -->
  <select id="exists" resultType="int">
    SELECT COUNT(*)
    FROM favorites
    WHERE user_id = #{userId}
      AND output_id = #{outputId}
  </select>

  <!-- お気に入りの Output 実体一覧（JOIN） -->
  <select id="selectOutputsByUser" parameterType="int" resultType="com.example.outputmanager.domain.Output">
    SELECT
      o.id,
      o.user_id     AS userId,
      o.category_id AS categoryId,
      o.title,
      o.summary,
      o.detail,
      o.icon,
      o.video_url   AS videoUrl,
      o.created_at  AS createdAt,
      o.updated_at  AS updatedAt
    FROM favorites f
      JOIN outputs o ON o.id = f.output_id
    WHERE f.user_id = #{userId}
    ORDER BY o.created_at DESC, o.id DESC
  </select>

</mapper>
